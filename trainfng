FROM alpine:latest AS build
RUN apk add --no-cache \
		cmake \
		curl-dev \
		make \
		g++ \
		gcc \
		git \
		libpng-dev \
		python3 \
		sqlite-dev \
		zlib-dev
<<<<<<< HEAD

RUN git clone \
	--no-tags \
	--progress \
	https://github.com/35niavlys/teeworlds-trainfng

WORKDIR /teeworlds-trainfng/build
RUN cmake .. -Wno-dev \
=======
WORKDIR /teeworlds-trainfng
WORKDIR build
RUN cmake .. \
	-Wno-dev \
>>>>>>> 40f7361 (dockerfiles small refactoring)
	-DAUTOUPDATE=OFF \
	-DCLIENT=OFF \
	-DMYSQL=OFF \
	-DVIDEORECORDER=OFF \
	-DUPNP=OFF

RUN make install -j$(nproc)

FROM alpine:latest
RUN apk add --no-cache libcurl libstdc++ sqlite-dev
COPY --from=build /usr/local/share/ddnet/ /usr/local/share/ddnet/
COPY --from=build /usr/local/bin/ /usr/local/bin/
WORKDIR /usr/local/share/ddnet/data/
ENTRYPOINT ["TrainFNG-Server"]
